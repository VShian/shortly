{% extends 'base.html' %}

{% block content %}

<div class="mx-auto max-w-9xl px-4 py-6 sm:px-6 lg:px-8 flex justify-center -mt-10">

    <div class="min-w-xl lg:max-w-lg m-auto">
        <h2 class="text-3xl font-bold tracking-tight sm:text-4xl">Shorten your URL</h2>
        <p class="mt-4 text-lg leading-8">
            Paste your long URL and get a shortened version in seconds.
        </p>
        <form method="post" action={% url 'home' %} class="mt-6 flex w-full gap-x-4">
            {% csrf_token %}
            <label for="url" class="sr-only">URL</label>
            <input id="url" name="url" type="url" required
                class="min-w-lg flex-auto rounded-md bg-white/5 px-3.5 py-2 shadow-sm ring-1 ring-inset focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6"
                value="{{ url }}" placeholder="Paste your URL">
            <button type="submit"
                class="flex-none rounded-md bg-indigo-700 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500">Shorten
                It <span aria-hidden="true">&rarr;</span> </button>
        </form>

        {% if short_url %}

        <div class="w-full mt-10">
            <div class="mb-2 flex justify-between items-center">
                <label for="website-url" class="text-sm font-medium text-gray-900">Your shortened
                    URL:</label>
            </div>
            <div class="flex items-center">
                <span
                    class="flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-900 bg-gray-100 border border-gray-300 rounded-s-lg">URL</span>
                <div
                    class="relative w-full flex flex-row w-full bg-gray-50 border border-e-0 border-gray-300 text-gray-500 text-sm border-s-0 focus:ring-blue-500 focus:border-blue-500 block p-2.5 items-center">
                    <a id="website-url" class="text-indigo-600 mx-2 underline" href="{{short_url}}" target="_blank">
                        {{short_url}}
                    </a>
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="16" height="16" viewBox="0 0 24 24">
                        <path
                            d="M 19.980469 2.9902344 A 1.0001 1.0001 0 0 0 19.869141 3 L 15 3 A 1.0001 1.0001 0 1 0 15 5 L 17.585938 5 L 8.2929688 14.292969 A 1.0001 1.0001 0 1 0 9.7070312 15.707031 L 19 6.4140625 L 19 9 A 1.0001 1.0001 0 1 0 21 9 L 21 4.1269531 A 1.0001 1.0001 0 0 0 19.980469 2.9902344 z M 5 3 C 3.9069372 3 3 3.9069372 3 5 L 3 19 C 3 20.093063 3.9069372 21 5 21 L 19 21 C 20.093063 21 21 20.093063 21 19 L 21 13 A 1.0001 1.0001 0 1 0 19 13 L 19 19 L 5 19 L 5 5 L 11 5 A 1.0001 1.0001 0 1 0 11 3 L 5 3 z">
                        </path>
                    </svg>

                </div>
                <button onclick="copyToClipboard()" data-tooltip-target="tooltip-website-url"
                    data-copy-to-clipboard-target="website-url"
                    class="flex-shrink-0 z-10 inline-flex items-center py-3 px-4 text-sm font-medium text-center text-black rounded-e-lg focus:ring-4 focus:outline-none focus:ring-blue-300 border border-blue-700 hover:border-blue-800"
                    type="button">
                    <span id="default-icon">
                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                            viewBox="0 0 18 20">
                            <path
                                d="M16 1h-3.278A1.992 1.992 0 0 0 11 0H7a1.993 1.993 0 0 0-1.722 1H2a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2Zm-3 14H5a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2Zm0-4H5a1 1 0 0 1 0-2h8a1 1 0 1 1 0 2Zm0-5H5a1 1 0 0 1 0-2h2V2h4v2h2a1 1 0 1 1 0 2Z" />
                        </svg>
                    </span>
                    <span id="success-icon" class="hidden inline-flex items-center">
                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                            viewBox="0 0 16 12">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M1 5.917 5.724 10.5 15 1.5" />
                        </svg>
                    </span>
                </button>
            </div>
        </div>

        {% endif %}

        {% if error %}

        <div class="my-4 p-4 text-sm text-red-800 rounded-lg bg-red-50" role="alert">
            {{ error}}
        </div>

        {% endif %}

    </div>

</div>

{% endblock %}

{% block scripts %}
<script>
    function copyToClipboard() {

        const value = document.getElementById('website-url').innerText;

        const $defaultIcon = document.getElementById('default-icon');
        const $successIcon = document.getElementById('success-icon');

        const showSuccess = () => {
            $defaultIcon.classList.add('hidden');
            $successIcon.classList.remove('hidden');
        }

        const resetToDefault = () => {
            $defaultIcon.classList.remove('hidden');
            $successIcon.classList.add('hidden');
        }

        navigator.clipboard.writeText(value).then(() => {
            showSuccess();

            // reset to default state
            setTimeout(() => {
                resetToDefault();
            }, 2000);

        }).catch((error) => {
            console.error('Failed to copy: ', error);
        });

    }
</script>
{% endblock %}